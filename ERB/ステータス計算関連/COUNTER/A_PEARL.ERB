@PEARL_CHK_MASTER
#DIM INSERTER
#DIM CONST INTERVAL = 30
#DIM KAKUNIN
#DIM LAPSE

SIF !TFLAG:パール期限
	RETURN

INSERTER = TFLAG:パール入れた人

;流石に他人がいるとチェックしない
KAKUNIN = 1
SIF CFLAG:INSERTER:現在位置 != CFLAG:MASTER:現在位置
	KAKUNIN = 0
SIF GET_TARGETNUM() > 1
	KAKUNIN = 0
SIF !SHIRAHU(INSERTER)
	KAKUNIN = 0

IF TFLAG:パール挿入個数
	SOURCE:MASTER:快Ａ += TIME_PROGRESS(TIME:1) * TFLAG:パール挿入個数
	SOURCE:MASTER:苦痛 += TIME_PROGRESS(TIME:1) * TFLAG:パール挿入個数 * 2
	DOWNBASE:MASTER:体力 += TIME_PROGRESS(TIME:1)
ENDIF

IF TFLAG:パール期限 < TIME && TFLAG:パール期限 > 0 && TFLAG:パール挿入個数
	PRINTFORML %CALLNAME:MASTER%坚持到了約定的時間
	PRINTFORML 把%CALLNAME:INSERTER%抜了出来
	TFLAG:パール期限 = -1
ENDIF
IF KAKUNIN
	IF TFLAG:パール期限 == -1
		PRINTFORMW %CALLNAME:INSERTER%は期限まで我慢できた%CALLNAME:MASTER%の頭を撫で的同时、肛門拉珠を一個ずつゆっくり引き抜いた
		CALL PEARL_EJECT("引っこ抜き")
		RETURN
	ELSEIF TFLAG:パール期限 == -2
		PRINTFORML 肛門拉珠が抜けきっていたことに気づいた%CALLNAME:INSERTER%は、やり直し、と言ってまた1玉ずつ%CALLNAME:MASTER%の直腸に押し込んだ！
		CALL PEARL_INSERT(INSERTER,5)
	ENDIF
ENDIF

LAPSE = (TIME - TFLAG:パール排出チェック) / INTERVAL

IF LAPSE && TFLAG:パール期限 > 0
	TFLAG:パール排出チェック = TIME
	IF KAKUNIN
		PRINTFORML %CALLNAME:INSERTER%は%CALLNAME:MASTER%の尻に手をやり、肛門拉珠の状態を確認した…
		PRINTFORML %CALLNAME:MASTER%の尻穴からパールがぶら下がっているのを確かめると、%CALLNAME:INSERTER%は微笑んで戒指を轻轻地引き、%CALLNAME:MASTER%にもう少し我慢するように言った…
		SOURCE:MASTER:快Ａ += 50
	ENDIF
	FOR LOCAL, 0, LAPSE
		CALL PEARL_PATIENCE
	NEXT
ENDIF

@PEARL_EJECT(ARGS)
#DIM INSERTER
#DIM OTOSIDAMA
INSERTER = TFLAG:パール入れた人

IF ARGS == "自然排出"
	SOURCE:MASTER:快Ａ += 100
	EXP:MASTER:Ａ経験 += 1
	TFLAG:パール挿入個数 -= 1
	PRINTFORMW 排出了1个肛珠（剩余{TFLAG:パール挿入個数}个）
	IF !TFLAG:パール挿入個数
		PRINTFORMW 把肛珠都排出来了…
		TFLAG:パール期限 = -2
	ENDIF
ELSEIF ARGS == "引っこ抜き"
	SOURCE:MASTER:快Ａ += TFLAG:パール挿入個数 * 200
	EXP:MASTER:Ａ経験 += TFLAG:パール挿入個数
	EXP:MASTER:苦痛快楽経験 += TFLAG:パール挿入個数 * 3
	EXP:INSERTER:嗜虐快楽経験 += TFLAG:パール挿入個数 * 3
	SOURCE:INSERTER:加虐 += TFLAG:パール挿入個数 * 100
	TFLAG:パール挿入個数 = 0
	TFLAG:パール期限 = 0
	TFLAG:パール入れた人 = 0
	TFLAG:パール排出チェック = 0
	IF FESTIVAL() == "元旦"
		SELECTCASE RAND:3
			CASE 0
				OTOSIDAMA = 10000
			CASE 1
				OTOSIDAMA = 30000
			CASE 2
				OTOSIDAMA = 50000
		ENDSELECT
		PRINTFORMW …？
		PRINTFORMW 肛珠的末端、有着不知道什么时候被放进去的黄金玉
		CALL COLORMESSAGE(@"红包奖励！获得了￥{OTOSIDAMA}！",C_YELLOW,2)
		MONEY += OTOSIDAMA
	ENDIF
ENDIF

@PEARL_INSERT(ARG,ARG:1)
TFLAG:パール挿入個数 = ARG:1
TFLAG:パール期限 = TIME + TFLAG:パール挿入個数 * 30 + RAND:30 + RAND:30
TFLAG:パール入れた人 = ARG
SOURCE:MASTER:快Ａ += TFLAG:パール挿入個数 * 10
TFLAG:パール排出チェック = TIME

@PEARL_PATIENCE
PRINTFORML 肛珠快要从肛門里出来了…
CALL ASK_M("忍住（気力50）",BASE:MASTER:気力 >= 50, "全力忍住（気力200）",BASE:MASTER:気力 >= 100, "放松力气",1)
SELECTCASE RESULT
	CASE 0
		DOWNBASE:MASTER:気力 += 50
		IF !RAND:2
			PRINTFORMW %CALLNAME:MASTER%忍住了排泄感
		ELSE
			PRINTFORMW %CALLNAME:MASTER%没能忍住排泄感
			CALL PEARL_EJECT("自然排出")
		ENDIF
	CASE 1
		PRINTFORMW %CALLNAME:MASTER%拼命忍住了排泄感
		DOWNBASE:MASTER:気力 += 200
	CASE 2
		CALL PEARL_EJECT("自然排出")
ENDSELECT