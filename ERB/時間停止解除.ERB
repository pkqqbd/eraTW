@時間停止解除
#DIM 逐出
#DIM 合計絶頂強度
#DIM 絶頂人数
#DIM 逸脱追加
VARSET LOCAL
FLAG:70 = 0
絶頂人数 = 0
TFLAG:運搬 = 0
FOR LOCAL,0,CHARANUM
	IF CFLAG:LOCAL:時間停止換装
		IF 睡眠時間(LOCAL)
			;睡衣セット
			CALL CTRL_CLOTHES_SET(LOCAL, "現在衣装の変更_睡衣")
			CFLAG:LOCAL:睡衣 = 1
		ELSEIF TCVAR:LOCAL:另一种便服
			;いつもと違う服
			CALL CTRL_CLOTHES_SET(LOCAL, "現在衣装の変更_衣装セット", SPECIAL_OUTFIT(LOCAL))
			CFLAG:LOCAL:睡衣 = 0
		ELSE
			;便装セット
			CALL CTRL_CLOTHES_SET(LOCAL, "現在衣装の変更_便装")
			CFLAG:LOCAL:睡衣 = 0
		ENDIF
		CALL CLOTHES_SETTING_TRAIN(LOCAL)
	ENDIF
NEXT

PRINTFORMW %CALLNAME:MASTER%解除了時間停止
逐出 = 0

CALL FISHER_YATES_SHAFFLE(CHARANUM - 1)

FOR LOCAL:10 , 0 , CHARANUM - 1
	LOCAL = SHAFFLE_ARRAY:(LOCAL:10) + 1
	IF CFLAG:LOCAL:現在位置 == CFLAG:MASTER:現在位置 && !CFLAG:LOCAL:睡眠
		合計絶頂強度 = EX:LOCAL:無自覚Ｃ絶頂 + EX:LOCAL:無自覚Ｖ絶頂 + EX:LOCAL:無自覚Ａ絶頂 + EX:LOCAL:無自覚Ｂ絶頂 + EX:LOCAL:無自覚Ｍ絶頂
		IF 合計絶頂強度 > 30
		;IF EX:LOCAL:Ｃ絶頂 + EX:LOCAL:Ｖ絶頂 + EX:LOCAL:Ａ絶頂 + EX:LOCAL:Ｂ絶頂 + EX:LOCAL:Ｍ絶頂 > 30
			SETCOLOR 255,100,255
			PRINTL 【強烈的快感】
			RESETCOLOR
			PRINTFORMW 突然袭来的激烈絶頂令%CALLNAME:LOCAL%发出甜美的娇喘声、当场瘫坐在地
			IF CFLAG:LOCAL:時間停止バレ == 1
				IF TALENT:LOCAL:恋慕
					PRINTFORMW %CALLNAME:LOCAL%紧紧抱住因快感而颤抖的身体、不停地小声念叨着%CALLNAME:MASTER%的名字
					SOURCE:LOCAL:欲情 += 500 + (CFLAG:2 - 1000) / 5
					SOURCE:LOCAL:情愛 += 500 + (CFLAG:2 - 1000) / 5
				ELSEIF TALENT:LOCAL:思慕
					PRINTFORMW %CALLNAME:LOCAL%一边享受着快感、一边不満地看着%CALLNAME:MASTER%
					SOURCE:LOCAL:欲情 += 300 + (CFLAG:2 - 1000) / 5
					SOURCE:LOCAL:反感 += 300
				ELSEIF TALENT:LOCAL:炮友 == 2
					PRINTFORMW %CALLNAME:LOCAL%喘着粗气、媚眼如丝地请求继续
					SOURCE:LOCAL:欲情 += 1000 + (CFLAG:2 - 1000) / 5
				ELSEIF TALENT:LOCAL:炮友 == 1
					PRINTFORMW %CALLNAME:LOCAL%一边因为快感而发出甜蜜的娇喘、一边因为这种没有商量过就做了起来的行為而投来了嫌悪的目光
					SOURCE:LOCAL:欲情 += 500 + (CFLAG:2 - 1000) / 5
					SOURCE:LOCAL:反感 += 300
				ELSEIF TALENT:LOCAL:愛欲
					PRINTFORMW %CALLNAME:LOCAL%露出喜悦的表情、为%CALLNAME:MASTER%给予的快感而颤抖着
					SOURCE:LOCAL:欲情 += 1000 + (CFLAG:2 - 1000) / 5
				ELSE
					PRINTFORMW %CALLNAME:LOCAL%一边因快感颤抖着、一边用愤怒的眼神瞪着%CALLNAME:MASTER%
					SOURCE:LOCAL:反感 += 10000
				ENDIF
			ENDIF
			CFLAG:LOCAL:延迟 += 20
			絶頂人数 += 1
			;恥情BOUNS
			CALL JUEL_UP_SPECIAL(LOCAL,"恥情","露出癖",2,1)
			
			;逸脱追加 = MAX(1000 - ABL:LOCAL:露出癖 * 200, 0)
			;SOURCE:LOCAL:逸脱 += 逸脱追加
			CALL KOJO_MESSAGE_SEND("EVENT",17,LOCAL,2,0)
		ELSEIF 合計絶頂強度 > 0
		;ELSEIF EX:LOCAL:Ｃ絶頂 + EX:LOCAL:Ｖ絶頂 + EX:LOCAL:Ａ絶頂 + EX:LOCAL:Ｂ絶頂 + EX:LOCAL:Ｍ絶頂 > 0
			SETCOLOR 255,100,255
			PRINTL 【謎之快感】
			RESETCOLOR
			PRINTFORMW %CALLNAME:LOCAL%被謎之快感吓了一跳、身体僵硬
			IF CFLAG:LOCAL:時間停止バレ == 1
				IF TALENT:LOCAL:恋慕
					PRINTFORMW %CALLNAME:LOCAL%假装摇摇晃晃地倒在%CALLNAME:MASTER%的胸前、小声地请求继续...
					SOURCE:LOCAL:欲情 += 500 + (CFLAG:2 - 1000) / 5
					SOURCE:LOCAL:情愛 += 500 + (CFLAG:2 - 1000) / 5
				ELSEIF TALENT:LOCAL:思慕
					PRINTFORMW %CALLNAME:LOCAL%一看到%CALLNAME:MASTER%就脸红了
					SOURCE:LOCAL:欲情 += 300 + (CFLAG:2 - 1000) / 5
					SOURCE:LOCAL:反感 += 300
				ELSEIF TALENT:LOCAL:炮友 == 2
					PRINTFORMW 是因为快感还不够吗、%CALLNAME:LOCAL%有些不满地注视着%CALLNAME:MASTER%
					SOURCE:LOCAL:欲情 += 1000 + (CFLAG:2 - 1000) / 5
				ELSEIF TALENT:LOCAL:炮友 == 1
					PRINTFORMW 
					SOURCE:LOCAL:欲情 += 500 + (CFLAG:2 - 1000) / 5
					SOURCE:LOCAL:反感 += 300
				ELSEIF TALENT:LOCAL:愛欲
					PRINTFORMW %CALLNAME:LOCAL%牵起%CALLNAME:MASTER%的手、喘着粗气请求继续
					SOURCE:LOCAL:欲情 += 1000 + (CFLAG:2 - 1000) / 5
				ELSE
					PRINTFORMW %CALLNAME:LOCAL%向%CALLNAME:MASTER%投来了怀疑的目光
					SOURCE:LOCAL:反感 += 1000
				ENDIF
			ENDIF
			絶頂人数 += 1
			CALL KOJO_MESSAGE_SEND("EVENT",17,LOCAL,1,0)
		ELSEIF CFLAG:LOCAL:291 == 1
			SETCOLOR 150,150,250
			PRINTL 【不寻常的開放感】
			RESETCOLOR
			PRINTFORMW 不知不觉间被脱掉内裤的%CALLNAME:LOCAL%一幅坐立不安的様子
			;本来ならCFLAG:295は作らずCFLAG:LOCAL:291 == 3とかで対応したほうが良い
			IF CFLAG:LOCAL:時間停止バレ == 1 && CFLAG:LOCAL:295 == 0
				IF TALENT:LOCAL:恋慕
					PRINTFORMW 
					SOURCE:LOCAL:欲情 += 500 + (CFLAG:2 - 1000) / 5
					SOURCE:LOCAL:情愛 += 500 + (CFLAG:2 - 1000) / 5
				ELSEIF TALENT:LOCAL:思慕
					PRINTFORMW 
					SOURCE:LOCAL:欲情 += 300 + (CFLAG:2 - 1000) / 5
					SOURCE:LOCAL:反感 += 300
				ELSEIF TALENT:LOCAL:炮友 == 2
					PRINTFORMW 
					SOURCE:LOCAL:欲情 += 1000 + (CFLAG:2 - 1000) / 5
				ELSEIF TALENT:LOCAL:炮友 == 1
					PRINTFORMW 
					SOURCE:LOCAL:欲情 += 500 + (CFLAG:2 - 1000) / 5
					SOURCE:LOCAL:反感 += 300
				ELSEIF TALENT:LOCAL:愛欲
					PRINTFORMW 
					SOURCE:LOCAL:欲情 += 1000 + (CFLAG:2 - 1000) / 5
				ELSE
					PRINTFORMW 
					SOURCE:LOCAL:反感 += 10000
				ENDIF
				CFLAG:LOCAL:295 = 1
			ENDIF
			CALL KOJO_MESSAGE_SEND("EVENT",17,LOCAL,3,0)
		ENDIF
		;無自覚絶頂カウントをリセットしておく
		FOR LOCAL:1,0,5
			IF EX:LOCAL:(LOCAL:1)
				EX:LOCAL:(LOCAL:1 + 20) = 0
				EX:LOCAL:(LOCAL:1 + 50) = 0
			ENDIF
		NEXT
		IF BATHCHECK(CFLAG:MASTER:現在位置) && AT_HOME(MASTER) && LOCAL != MASTER
			SIF 風呂逐出条件(LOCAL) && CFLAG:LOCAL:現在位置 == CFLAG:MASTER:現在位置
				CALL 風呂から逐出(LOCAL)
			SIF RESULT
				逐出 ++
		ELSE
			IF CFLAG:LOCAL:287 == 2
				SETCOLOR 255,100,255
				PRINTL 【無自覚肛門射精】
				RESETCOLOR
				;感度も10超えがあるわけだし、地の文だけでもバリエーションを足してみた
				SELECTCASE ABL:LOCAL:2
					CASE 0 TO 2
						PRINTFORMW %CALLNAME:LOCAL%因为突如其来的肛門疼痛发出了小声的悲鳴
						CALL KOJO_MESSAGE_SEND("EVENT",17,LOCAL,7,1)
					CASE 3 TO 5
						PRINTFORMW %CALLNAME:LOCAL%好像感到了直腸里精液带来的強烈異样感
						PRINTFORMW 发出了咿的、轻声悲鳴
						CALL KOJO_MESSAGE_SEND("EVENT",17,LOCAL,7,2)
					CASE IS >= 6
						PRINTFORMW 也许是无法忍受突然注入已经变成第二性器的排泄器官里的灼熱精液的触感、
						PRINTFORMW %CALLNAME:LOCAL%轻轻地炽热地喘息着。
						CALL KOJO_MESSAGE_SEND("EVENT",17,LOCAL,7,2)
					;現在ロック中。はたしてこの反応は有りか否か？
					CASEELSE
						PRINTFORMW 即使是屁股里突然传来的炙熱感
						PRINTFORMW 对现在的%CALLNAME:LOCAL%来说也只不过是快楽的调料吧
						PRINTFORMW 毫不掩饰陶醉的表情、吐出了甘美的喘息。
						CALL KOJO_MESSAGE_SEND("EVENT",17,LOCAL,7,2)
				ENDSELECT
				CFLAG:LOCAL:肛門射精 = 0
			ENDIF
			IF EX:LOCAL:処女喪失记号
				SETCOLOR 250,100,100
				IF EX:LOCAL:処女喪失记号 == 1
					PRINTL 【無自覚処女喪失】
				ELSE
					PRINTL 【無自覚再生処女喪失】
				ENDIF
				RESETCOLOR
				PRINTFORMW %CALLNAME:LOCAL%因为股間的鈍痛而皱起了眉头…
				CALL KOJO_MESSAGE_SEND("EVENT",17,LOCAL,8,0)
			ENDIF
			IF CFLAG:LOCAL:286 == 2
				SETCOLOR 255,100,255
				PRINTL 【無自覚膣内射精】
				RESETCOLOR
				IF EX:LOCAL:処女喪失记号 != 1 && TALENT:LOCAL:処女 != -1
					IF TALENT:LOCAL:無知 && EXP:LOCAL:精液経験 < 100
						PRINTFORML %CALLNAME:LOCAL%似乎察觉到了陰道内精液的异样感但又
						PRINTFORMW 不知道那是什么东西的触感而显得坐立不安……
						CALL KOJO_MESSAGE_SEND("EVENT",17,LOCAL,9,3)
					ELSEIF !TCVAR:LOCAL:口服避孕薬
						PRINTFORMW %CALLNAME:LOCAL%似乎通过下腹部传来的异样感注意到了自己被膣内射精的事实
						PRINTFORMW 脸色一下子变得蒼白、但还是坐立不安地想要掩饰……
						CALL KOJO_MESSAGE_SEND("EVENT",17,LOCAL,9,1)
					ELSEIF EX:LOCAL:処女喪失记号 == 0 && TCVAR:LOCAL:口服避孕薬 == 1
						PRINTFORMW %CALLNAME:LOCAL%似乎通过下腹部传来的异样感注意到了自己被膣内射精的事实
						PRINTFORMW 可能是因为服用过避孕药、虽然有些困惑但并没有很慌张……
						CALL KOJO_MESSAGE_SEND("EVENT",17,LOCAL,9,2)
					ENDIF
				ELSE
					PRINTFORML %CALLNAME:LOCAL%似乎察觉到了陰道内精液的异样感但又
					PRINTFORMW 不知道那是什么东西的触感而显得坐立不安……
					CALL KOJO_MESSAGE_SEND("EVENT",17,LOCAL,9,3)
				ENDIF
				CFLAG:LOCAL:286 = 0
			ENDIF
			;無自覚膣内射精の処理の後で無自覚処女喪失のフラグを折る
				EX:LOCAL:処女喪失记号 = 0
			IF CFLAG:LOCAL:288 == 2
				SETCOLOR 255,100,255
				PRINTL 【無自覚口内射精】
				RESETCOLOR
				IF TALENT:MASTER:濃厚精液
					PRINTFORM %CALLNAME:LOCAL%因突然出現在口中的%SAMEN_DESCRIPTION(PLAYER)%而
					IF ABL:LOCAL:精液中毒 < 3
						PRINTFORML 激烈的咳嗽、被嗆到了
						PRINTFORML 因爲粘在口腔里和食道上的精液不容易吐出來、%CALLNAME:LOCAL%含著眼淚不停地嘔吐
						PRINTFORMW ……感觉自己做了一件壞事
						CALL KOJO_MESSAGE_SEND("EVENT",17,LOCAL,4,5)
					ELSE
						PRINTFORML 虽然很惊讶、但还是装出若无其事的样子闭上了嘴
						PRINTFORMW 然後慢慢地動着舌頭、仔細地品尝粘稠的慾望果凍…
						CALL KOJO_MESSAGE_SEND("EVENT",17,LOCAL,4,6)
					ENDIF
				ELSEIF ABL:LOCAL:精液中毒 < 3
					PRINTFORM %CALLNAME:LOCAL%被射到嘴里的精液呛到
					IF !RAND:3
						PRINTFORMW 了、不由自主地吞了下去
						CALL KOJO_MESSAGE_SEND("EVENT",17,LOCAL,4,1)
					ELSEIF !RAND:2
						PRINTFORMW 了、好不容易才找到机会吐了出来
						CALL KOJO_MESSAGE_SEND("EVENT",17,LOCAL,4,2)
					ELSE
						PRINTFORMW 了、急忙捂住嘴巴
						CALL KOJO_MESSAGE_SEND("EVENT",17,LOCAL,4,3)
					ENDIF
					PRINTFORMW 因为突发事态而含着眼泪咳嗽着…
				ELSE
					PRINTFORMW %CALLNAME:LOCAL%被射进嘴里的精液吓了一跳、但还是装作没事一様地将它吞了下去
					PRINTFORMW %CALLNAME:LOCAL%感受到了一种奇怪的兴奋感…
					CALL KOJO_MESSAGE_SEND("EVENT",17,LOCAL,4,4)
				ENDIF
				CFLAG:LOCAL:288 = 0
			ENDIF
			IF CFLAG:LOCAL:289 == 2
				SETCOLOR 255,100,255
				PRINTL 【無自覚顔面射精】
				RESETCOLOR
				IF ABL:LOCAL:精液中毒 < 3
					IF TALENT:LOCAL:無知 && EXP:LOCAL:精液経験 < 100
						PRINTFORMW %CALLNAME:LOCAL%不快地擦掉了粘在脸上的精液
						PRINTFORMW 看起来%CALLNAME:LOCAL%并没有注意到粘在脸上的精液是什么
						CALL KOJO_MESSAGE_SEND("EVENT",17,LOCAL,5,1)
					ELSE
						PRINTFORMW %CALLNAME:LOCAL%注意到了粘在脸上的精液、连忙将它擦掉了
						PRINTFORMW 虽然装作什么也没发生、但表情还是有点僵硬
						CALL KOJO_MESSAGE_SEND("EVENT",17,LOCAL,5,2)
					ENDIF
				ELSE
					PRINTFORMW 正在擦掉粘在脸上的精液的%CALLNAME:LOCAL%、偷偷用手指沾起一部分送到了嘴里
					PRINTFORMW %CALLNAME:LOCAL%感受到了一种奇怪的兴奋感…
					CALL KOJO_MESSAGE_SEND("EVENT",17,LOCAL,5,3)
				ENDIF
				CFLAG:LOCAL:288 = 0
			ENDIF
			IF CFLAG:LOCAL:290 == 2
				SETCOLOR 255,100,255
				PRINTL 【無自覚手淫射精】
				RESETCOLOR
				IF ABL:LOCAL:精液中毒 < 3
					PRINTFORMW %CALLNAME:LOCAL%注意到了粘在手掌上的精液、不快地擦掉了
					CALL KOJO_MESSAGE_SEND("EVENT",17,LOCAL,6,1)
				ELSE
					PRINTFORMW %CALLNAME:LOCAL%偷偷舔了舔了粘在手掌上的精液并擦掉了
					PRINTFORMW %CALLNAME:LOCAL%感受到了一种奇怪的兴奋感…
						CALL KOJO_MESSAGE_SEND("EVENT",17,LOCAL,6,2)
				ENDIF
				CFLAG:LOCAL:290 = 0
			ENDIF
			CALL KOJO_MESSAGE_SEND("EVENT",17,LOCAL,0,0)
		ENDIF

	ENDIF
	CFLAG:LOCAL:288 = 0
	CFLAG:LOCAL:289 = 0
	CFLAG:LOCAL:290 = 0
	CFLAG:LOCAL:344 = 0
NEXT
IF 絶頂人数 >= 1 && !逐出
	PRINTFORM %CALLNAME:MASTER%向少女
	SIF 絶頂人数 >= 2
		PRINT 們
	PRINTW 表示擔心
ENDIF
FOR LOCAL,1,CHARANUM
	CALL 被从寝室赶了出来(LOCAL)
NEXT
;(天候パッチ)時刻・天候に応じて背景色を変更
IF FLAG:背景色推移
	CALL SET_MAP_WEATHER_BGCOLOR
ELSE
	RESETBGCOLOR
ENDIF
